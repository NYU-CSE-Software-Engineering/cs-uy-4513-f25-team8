<% provide :title, "Contact Messages" %>

<div class="row mb-4">
  <div class="col-12">
    <h1 class="display-5 fw-bold mb-2">
      <i class="bi bi-envelope me-2 text-primary"></i>Contact Messages
    </h1>
    <p class="text-muted">View and manage user feedback and inquiries</p>
  </div>
</div>

<!-- Search Form -->
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <%= form_with url: admin_contacts_path, method: :get, local: true, class: "row g-3" do |f| %>
      <div class="col-md-10">
        <%= f.label :search, "Search by name, email, or subject", class: "form-label fw-semibold" %>
        <%= f.text_field :search, value: params[:search], class: "form-control form-control-lg", placeholder: "Enter search term..." %>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <%= f.submit "Search", class: "btn btn-primary btn-lg w-100" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Contacts Table -->
<% if @contacts.any? %>
  <div class="card shadow-sm border-0">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col">From</th>
              <th scope="col">Email</th>
              <th scope="col">Subject</th>
              <th scope="col">User</th>
              <th scope="col">Date</th>
              <th scope="col" class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @contacts.each do |contact| %>
              <tr>
                <td>
                  <strong><%= contact.name %></strong>
                </td>
                <td>
                  <small class="text-muted"><%= contact.email %></small>
                </td>
                <td>
                  <%= truncate(contact.subject, length: 50) %>
                </td>
                <td>
                  <% if contact.user %>
                    <span class="badge bg-info">
                      <%= contact.user.username %>
                    </span>
                  <% else %>
                    <span class="text-muted">Guest</span>
                  <% end %>
                </td>
                <td>
                  <small class="text-muted">
                    <%= contact.created_at.strftime("%b %d, %Y") %>
                  </small>
                </td>
                <td class="text-end">
                  <%= link_to admin_contact_path(contact), class: "btn btn-sm btn-outline-primary" do %>
                    <i class="bi bi-eye me-1"></i>View
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% else %>
  <div class="card shadow-sm border-0">
    <div class="card-body text-center py-5">
      <i class="bi bi-inbox display-1 text-muted mb-3"></i>
      <h4 class="text-muted">No messages found</h4>
      <p class="text-muted">Try adjusting your search criteria.</p>
    </div>
  </div>
<% end %>
